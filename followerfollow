javascript:(async%20function()%7Btry%7Bconst%20c=document.cookie.match(/scratchcsrftoken=(%5B%5E;%5D+)/);if(!c)%7Balert(%22ログイン済みタブで実行してください（CSRFが必要です）%22);return;%7Dconst%20csrftoken=decodeURIComponent(c%5B1%5D);const%20me=prompt(%22あなたのユーザー名を入力してください%22,%22%22);if(!me)return;const%20target=prompt(%22対象のユーザー名を入力してください（その人のフォロワーを取得します）%22,%22%22);if(!target)return;let%20intervalSec=parseFloat(prompt(%22フォロー間隔（秒）%22,%225%22));if(isNaN(intervalSec)%7C%7CintervalSec%3C1)intervalSec=1;let%20panel=document.getElementById(%22autoFollowPanel%22);if(!panel)%7Bpanel=document.createElement(%22div%22);panel.id=%22autoFollowPanel%22;Object.assign(panel.style,%7Bposition:%22fixed%22,top:%228px%22,right:%228px%22,width:%22360px%22,maxHeight:%2260vh%22,overflow:%22auto%22,background:%22rgba(255,255,255,0.98)%22,border:%222px%20solid%20%23333%22,zIndex:2147483647,fontSize:%2213px%22,padding:%228px%22,boxShadow:%220%202px%208px%20rgba(0,0,0,0.2)%22%7D);const%20stopBtn=document.createElement(%22button%22);stopBtn.textContent=%22STOP%22;stopBtn.style.display=%22block%22;stopBtn.style.marginBottom=%226px%22;stopBtn.onclick=()=%3E%7Bwindow._autoFollowStop=true;appendLog(%22停止要求%20受信%22,%22crimson%22)%7D;panel.appendChild(stopBtn);const%20title=document.createElement(%22div%22);title.innerHTML=%60%3Cb%3E自分未フォローのみフォロー:%20$%7Btarget%7D%3C/b%3E%60;title.style.marginBottom=%226px%22;panel.appendChild(title);const%20logDiv=document.createElement(%22div%22);logDiv.id=%22autoFollowLog%22;panel.appendChild(logDiv);document.body.appendChild(panel);%7Dconst%20logDiv=document.getElementById(%22autoFollowLog%22);function%20appendLog(msg,color)%7Bconst%20d=document.createElement(%22div%22);d.textContent=msg;%20if(color)%20d.style.color=color;%20logDiv.appendChild(d);%20logDiv.scrollTop=logDiv.scrollHeight;%7DappendLog(%22開始:%20%22+(new%20Date()).toLocaleTimeString(),%22blue%22);appendLog(%22あなた:%20%22+me+%22%20/%20対象:%20%22+target+%22%20/%20間隔:%20%22+intervalSec+%22秒%22,%22blue%22);window._autoFollowStop=false;async%20function%20fetchAllFollowing(username)%7BappendLog(%22自分の%20following%20を取得中…%22);const%20set=new%20Set();let%20off=0,lim=40;while(true)%7Bif(window._autoFollowStop)%20break;const%20url=%60https://api.scratch.mit.edu/users/$%7BencodeURIComponent(username)%7D/following?limit=$%7Blim%7D&offset=$%7Boff%7D%60;try%7Bconst%20r=await%20fetch(url,%7Bcredentials:%22include%22%7D);if(!r.ok)%7BappendLog(%22自フォロー取得HTTPエラー%20%22+r.status,%22orange%22);break;%7Dconst%20arr=await%20r.json();if(!arr%7C%7Carr.length===0)break;for(const%20it%20of%20arr)%20if(it%20&&%20it.username)%20set.add(String(it.username).toLowerCase());off+=lim;appendLog(%22取得中…%20%22+set.size+%22%20人%22);await%20new%20Promise(r=%3EsetTimeout(r,120));%7Dcatch(e)%7BappendLog(%22自フォロー取得例外:%20%22+e,%22orange%22);break;%7D%7DappendLog(%22既フォロー取得完了:%20%22+set.size+%22%20人%22,%22green%22);return%20set;%7Dasync%20function%20fetchAllFollowers(username)%7BappendLog(username+%22%20のフォロワーを取得中…%22);const%20list=%5B%5D;let%20off=0,lim=40;while(true)%7Bif(window._autoFollowStop)%20break;const%20url=%60https://api.scratch.mit.edu/users/$%7BencodeURIComponent(username)%7D/followers?limit=$%7Blim%7D&offset=$%7Boff%7D%60;try%7Bconst%20r=await%20fetch(url,%7Bcredentials:%22include%22%7D);if(!r.ok)%7BappendLog(%22フォロワー取得HTTPエラー%20%22+r.status,%22orange%22);break;%7Dconst%20arr=await%20r.json();if(!arr%7C%7Carr.length===0)break;for(const%20it%20of%20arr)%20if(it%20&&%20it.username)%20list.push(it.username);off+=lim;appendLog(%22取得中…%20%22+list.length+%22%20人%22);await%20new%20Promise(r=%3EsetTimeout(r,120));%7Dcatch(e)%7BappendLog(%22フォロワー取得例外:%20%22+e,%22orange%22);break;%7D%20%7DappendLog(%22フォロワー取得完了:%20%22+list.length+%22%20人%22,%22green%22);return%20list;%7Dconst%20followingSet=await%20fetchAllFollowing(me);if(window._autoFollowStop)%7BappendLog(%22処理中断（自フォロー取得時）%22,%22crimson%22);return;%7Dconst%20followers=await%20fetchAllFollowers(target);if(window._autoFollowStop)%7BappendLog(%22処理中断（フォロワー取得時）%22,%22crimson%22);return;%7Dif(!followers%7C%7Cfollowers.length===0)%7BappendLog(%22対象のフォロワーが見つかりません%22,%22red%22);return;%7DappendLog(%22処理開始（対象フォロワー数:%20%22+followers.length+%22）%22,%22blue%22);const%20retryCounts=%7B%7D;const%20MAX_RETRY=6;function%20wait(ms)%7Breturn%20new%20Promise(r=%3EsetTimeout(r,ms));%7Dfunction%20backoffSec(n)%7Breturn%20Math.min(10,1*Math.pow(10,n));%7Dfor(let%20i=0;i%3Cfollowers.length;i++)%7Bif(window._autoFollowStop)%7BappendLog(%22処理停止（ユーザー）%22,%22crimson%22);break;%7Dconst%20user=followers%5Bi%5D;appendLog(%60($%7Bi+1%7D/$%7Bfollowers.length%7D)%20→%20$%7Buser%7D%60);const%20userLc=String(user).toLowerCase();if(followingSet.has(userLc))%7BappendLog(%22スキップ（既フォロー）:%20%22+user,%22gray%22);continue;%7Dlet%20tried=0;while(true)%7Bif(window._autoFollowStop)%7BappendLog(%22処理停止（ユーザー:%20%22+user+%22)%22,%22crimson%22);break;%7Dtry%7Bconst%20res=await%20fetch(%60/site-api/users/followers/$%7BencodeURIComponent(user)%7D/add/%60,%7Bmethod:%22PUT%22,credentials:%22include%22,headers:%7B%22X-CSRFToken%22:csrftoken,%22X-Requested-With%22:%22XMLHttpRequest%22,%22Accept%22:%22application/json%22%7D%7D);if(res.ok)%7BappendLog(%22成功:%20%22+user,%22green%22);followingSet.add(userLc);break;%7Delse%20if(res.status===429)%7Btried++;retryCounts%5Buser%5D=(retryCounts%5Buser%5D%7C%7C0)+1;%20if(tried%3EMAX_RETRY)%7BappendLog(%22429%20再試行上限、スキップ:%20%22+user,%22gray%22);break;%7Dconst%20w=backoffSec(tried);appendLog(%22429:%20レート制限%E3%80%82%22+user+%22%20を%20%22+w+%22%20秒後に再試行%20(%22+tried+%22/%22+MAX_RETRY+%22)%22,%22crimson%22);await%20wait(w*1000);continue;%7Delse%20if(res.status===400%7C%7Cres.status===403)%7BappendLog(%22スキップ(%22+res.status+%22):%20%22+user,%22gray%22);followingSet.add(userLc);break;%7Delse%7BappendLog(%22失敗(%22+res.status+%22):%20%22+user,%22orange%22);break;%7D%7Dcatch(e)%7Btried++;appendLog(%22例外:%20%22+user+%22%20/%20%22+e,%22orange%22);if(tried%3EMAX_RETRY)%7BappendLog(%22例外で再試行上限、スキップ:%20%22+user,%22gray%22);break;%7Dconst%20w=Math.min(60,5*tried);await%20wait(w*1000);continue;%7D%7Dawait%20wait(Math.max(1000,Math.floor(intervalSec*1000)));%7DappendLog(%22全処理終了%22,%22blue%22);%7Dcatch(e)%7Balert(%22エラー:%20%22+e);console.error(e);%7D%7D)();
